# MCP配置管理界面设计说明

## 1. 界面概览

基于用户注册自动化PRD中的MCP分组管理需求，设计了完整的MCP配置管理界面，集成到系统设置页面中。

### 1.1 页面位置
- **路径**: `/settings` → "MCP配置"选项卡
- **权限**: 管理员用户
- **样式**: 与现有Dify配置保持一致

### 1.2 主要功能
- **MCP工具分组管理**: 创建、编辑、删除、启用/禁用分组
- **API密钥管理**: 查看、重新生成API密钥
- **MCP工具配置**: 查看、配置、启用/禁用工具
- **工具发现**: 自动刷新和发现新的MCP工具

## 2. 界面结构

### 2.1 选项卡导航
```
基本设置 | AI模型配置 | 安全与访问控制 | Dify配置 | [MCP配置] ← 新增
```

### 2.2 MCP配置页面结构
```
📋 MCP配置
├── 📢 说明提示区域
│   └── "MCP（Model Context Protocol）配置管理：通过分组方式管理AI工具..."
├── 🔄 子选项卡
│   ├── "工具分组管理" (默认选中)
│   └── "工具配置管理"
└── 📊 内容区域
```

## 3. 工具分组管理界面

### 3.1 界面布局
```
🏷️ MCP工具分组管理
📝 管理MCP工具分组，每个分组拥有独立的API密钥用于权限控制

[+ 添加分组] ← 橙色按钮

┌────────────────────────────────────────────────────────────────┐
│ 序号 │ 分组名称 │ 分组描述 │ API密钥 │ 工具数量 │ 启用状态 │ 创建时间 │ 操作 │
├────────────────────────────────────────────────────────────────┤
│  1   │用户服务组│用户信息...│mcp_key_••••••••••••│ 3个 │   ✓   │2025-01-01│[✏️][🔄][🗑️]│
│  2   │业务分析组│客户分析...│mcp_key_••••••••••••│ 2个 │   ✓   │2025-01-01│[✏️][🔄][🗑️]│
└────────────────────────────────────────────────────────────────┘
```

### 3.2 功能特性

#### API密钥显示/隐藏
- **默认状态**: `mcp_key_••••••••••••••••••••`
- **点击眼睛图标**: 显示完整密钥
- **安全考虑**: 默认隐藏，点击才显示

#### 操作按钮
- **编辑**: 修改分组名称和描述
- **重新生成**: 重新生成API密钥（确认提示）
- **删除**: 删除分组（确认提示）

#### 启用状态开关
- **Switch组件**: 实时切换启用/禁用状态
- **级联影响**: 禁用分组会影响其下所有工具

## 4. 工具配置管理界面

### 4.1 界面布局
```
🔧 MCP工具配置管理
📝 管理各个MCP工具的配置参数和启用状态

[🔄 刷新工具列表] ← 橙色按钮

┌──────────────────────────────────────────────────────────────────┐
│序号│工具名称│所属分组│版本│描述│超时时间(秒)│启用状态│操作│
├──────────────────────────────────────────────────────────────────┤
│ 1  │get_user_profile│用户服务组│1.0.0│获取用户基本信息│30│✓│[✏️][⚙️]│
│ 2  │analyze_customer│业务分析组│1.0.0│分析客户画像...│30│✓│[✏️][⚙️]│
└──────────────────────────────────────────────────────────────────┘
```

### 4.2 功能特性

#### 自动工具发现
- **刷新按钮**: 重新扫描和发现新的MCP工具
- **自动同步**: 与MCP服务器的工具注册表同步

#### 工具配置
- **编辑**: 修改工具参数、超时时间等
- **分组关联**: 设置工具所属的分组
- **启用控制**: 独立控制每个工具的启用状态

## 5. 交互流程

### 5.1 创建分组流程
```
1. 点击"添加分组"按钮
2. 弹出对话框，填写分组信息
   ├── 分组名称 (必填)
   └── 分组描述 (可选)
3. 点击"创建"按钮
4. 系统自动生成API密钥
5. 分组添加到列表中
```

### 5.2 API密钥管理流程
```
查看密钥:
点击👁️图标 → 显示完整密钥 → 再次点击隐藏

重新生成密钥:
点击🔄按钮 → 确认对话框 → 生成新密钥 → 旧密钥失效
```

### 5.3 工具配置流程
```
1. 进入"工具配置管理"选项卡
2. 点击"刷新工具列表"发现新工具
3. 选择工具进行配置
   ├── 分组分配
   ├── 超时设置
   ├── 启用状态
   └── 其他参数
4. 保存配置
```

## 6. 技术实现

### 6.1 组件架构
```
MCPConfigPanel (主组件)
├── useMCPConfigs (Hook)
│   ├── 状态管理 (groups, tools, loading, submitting)
│   ├── 分组操作 (create, update, delete, regenerateKey)
│   └── 工具操作 (update, refresh)
├── mcpConfigService (服务层)
│   ├── API调用封装
│   └── 错误处理
└── UI组件
    ├── Tabs (选项卡)
    ├── Table (数据表格)
    ├── Dialog (对话框)
    ├── Switch (开关)
    └── Button (按钮)
```

### 6.2 状态管理
```typescript
// Hook状态
const {
  groups,           // 分组列表
  tools,            // 工具列表
  isLoading,        // 加载状态
  isSubmitting,     // 提交状态
  createGroup,      // 创建分组
  updateGroup,      // 更新分组
  deleteGroup,      // 删除分组
  regenerateApiKey, // 重新生成密钥
  updateTool,       // 更新工具
  refreshTools      // 刷新工具
} = useMCPConfigs()
```

### 6.3 API接口设计
```
GET    /api/v1/mcp/groups              - 获取分组列表
POST   /api/v1/mcp/groups              - 创建分组
PUT    /api/v1/mcp/groups/{id}         - 更新分组
DELETE /api/v1/mcp/groups/{id}         - 删除分组
GET    /api/v1/mcp/groups/{id}/api-key - 获取API密钥
POST   /api/v1/mcp/groups/{id}/regenerate-key - 重新生成密钥

GET    /api/v1/mcp/tools              - 获取工具列表
PUT    /api/v1/mcp/tools/{id}         - 更新工具
POST   /api/v1/mcp/tools/refresh      - 刷新工具列表
GET    /api/v1/mcp/status             - MCP服务器状态
```

## 7. 样式规范

### 7.1 设计原则
- **一致性**: 与现有Dify配置页面保持完全一致
- **响应式**: 支持不同屏幕尺寸
- **可访问性**: 符合无障碍访问标准

### 7.2 颜色规范
- **主色调**: 橙色 (#f97316) - 与系统主题一致
- **表格**: 斑马纹样式，便于阅读
- **状态指示**: 绿色(启用)、灰色(禁用)
- **危险操作**: 红色(删除按钮)

### 7.3 交互反馈
- **加载状态**: Spinner + 文字提示
- **提交状态**: 按钮禁用 + Loading效果
- **操作反馈**: 成功/失败状态提示
- **确认对话框**: 危险操作前的二次确认

## 8. 用户体验考虑

### 8.1 易用性
- **清晰的导航**: 选项卡结构清晰
- **直观的操作**: 图标含义明确
- **即时反馈**: 操作结果立即可见

### 8.2 安全性
- **API密钥保护**: 默认隐藏敏感信息
- **操作确认**: 危险操作需要二次确认
- **权限控制**: 只有管理员可访问

### 8.3 性能优化
- **异步操作**: 不阻塞用户界面
- **状态管理**: 合理的加载和提交状态
- **错误处理**: 优雅的错误提示和恢复

## 9. 开发要点

### 9.1 技术栈
- **React 18**: 使用最新的Hook API
- **TypeScript**: 完整的类型支持
- **Tailwind CSS**: 与系统样式一致
- **shadcn/ui**: 使用标准UI组件库

### 9.2 关键实现
```typescript
// 1. Hook封装状态管理
const useMCPConfigs = () => {
  // 状态和操作逻辑
}

// 2. 服务层API调用
class MCPConfigService {
  async getGroups() { /* API调用 */ }
  async createGroup() { /* API调用 */ }
}

// 3. 组件组合
const MCPConfigPanel = () => {
  // UI渲染和事件处理
}
```

### 9.3 注意事项
- **类型安全**: 严格的TypeScript类型检查
- **错误边界**: 处理API调用失败场景
- **用户体验**: 加载状态和操作反馈
- **代码复用**: 与现有组件保持一致的模式

---

**设计完成时间**: 2025年1月
**设计状态**: 已实现并集成到系统中
**维护者**: 前端团队 