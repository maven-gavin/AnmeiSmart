# Agent Chat é«˜ä¼˜å…ˆçº§å’Œä¸­ä¼˜å…ˆçº§åŠŸèƒ½å®ç°å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ å®ç°æ¦‚è§ˆ

æœ¬æ¬¡å¼€å‘æˆåŠŸå®ç°äº† Agent Chat ç³»ç»Ÿçš„é«˜ä¼˜å…ˆçº§å’Œä¸­ä¼˜å…ˆçº§åŠŸèƒ½ï¼Œå¤§å¹…æå‡äº†ç”¨æˆ·ä½“éªŒå’ŒåŠŸèƒ½å®Œæ•´æ€§ã€‚

### âœ… å·²å®ŒæˆåŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | ä¼˜å…ˆçº§ | å®ç°çŠ¶æ€ | è¯´æ˜ |
|---------|--------|---------|------|
| **å¯¹è¯å‰è¾“å…¥è¡¨å•** | ğŸ”´ é«˜ | âœ… å®Œæˆ | æ”¯æŒ6ç§è¾“å…¥ç±»å‹ï¼Œè¡¨å•éªŒè¯ï¼Œå¯æŠ˜å è®¾è®¡ |
| **è¯­éŸ³è¾“å…¥ (STT)** | ğŸŸ¡ ä¸­ | âœ… å®Œæˆ | é›†æˆåˆ°æ¶ˆæ¯è¾“å…¥æ¡†ï¼Œæ”¯æŒå½•éŸ³å’Œé¢„è§ˆ |
| **æ–‡ä»¶ä¸Šä¼ ** | ğŸŸ¡ ä¸­ | âœ… å®Œæˆ | æ”¯æŒå›¾ç‰‡å’Œæ–‡ä»¶ä¸Šä¼ ï¼Œåª’ä½“é¢„è§ˆ |
| **æ–‡å­—è½¬è¯­éŸ³ (TTS)** | ğŸŸ¡ ä¸­ | âœ… å®Œæˆ | AIå›å¤è¯­éŸ³æ’­æ”¾ï¼Œæµå¼TTSæ”¯æŒ |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### 1. ç±»å‹ç³»ç»Ÿå¢å¼º

**æ–‡ä»¶**: `web/src/types/agent-chat.ts`

```typescript
// ç”¨æˆ·è¾“å…¥è¡¨å•å­—æ®µ
export interface UserInputFormField {
  variable: string;
  label: string;
  type: 'text-input' | 'paragraph' | 'number' | 'select' | 'file' | 'file-list';
  required: boolean;
  max_length?: number;
  default?: string | number;
  options?: string[];
  hide?: boolean;
  description?: string;
}

// åº”ç”¨å‚æ•°é…ç½®
export interface ApplicationParameters {
  opening_statement?: string;
  suggested_questions?: string[];
  user_input_form?: UserInputFormField[];
  speech_to_text?: { enabled: boolean };
  file_upload?: {
    enabled: boolean;
    allowed_file_types?: string[];
    allowed_file_upload_methods?: string[];
    number_limits?: number;
  };
  text_to_speech?: {
    enabled: boolean;
    voice?: string;
    language?: string;
  };
  // ... å…¶ä»–é…ç½®
}
```

### 2. æ ¸å¿ƒç»„ä»¶å®ç°

#### UserInputForm ç»„ä»¶
**æ–‡ä»¶**: `web/src/components/agents/UserInputForm.tsx`

**åŠŸèƒ½ç‰¹æ€§**:
- æ”¯æŒ6ç§è¾“å…¥ç±»å‹ï¼šæ–‡æœ¬ã€æ®µè½ã€æ•°å­—ã€é€‰æ‹©ã€æ–‡ä»¶ã€æ–‡ä»¶åˆ—è¡¨
- è¡¨å•éªŒè¯ï¼šå¿…å¡«éªŒè¯ã€é•¿åº¦é™åˆ¶ã€ç±»å‹æ£€æŸ¥
- å¯æŠ˜å /å±•å¼€è®¾è®¡
- å­—ç¬¦è®¡æ•°æ˜¾ç¤º
- é”™è¯¯æç¤ºå’ŒçŠ¶æ€ç®¡ç†

**ä½¿ç”¨ç¤ºä¾‹**:
```tsx
<UserInputForm
  fields={[
    {
      variable: 'name',
      label: 'å§“å',
      type: 'text-input',
      required: true,
      max_length: 50
    }
  ]}
  onSubmit={(values) => console.log(values)}
/>
```

#### TextToSpeechButton ç»„ä»¶
**æ–‡ä»¶**: `web/src/components/agents/TextToSpeechButton.tsx`

**åŠŸèƒ½ç‰¹æ€§**:
- è°ƒç”¨åç«¯ TTS API
- éŸ³é¢‘æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾/åœæ­¢ï¼‰
- åŠ è½½çŠ¶æ€æŒ‡ç¤º
- é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
- éŸ³é¢‘èµ„æºè‡ªåŠ¨æ¸…ç†

#### å¢å¼ºçš„ MessageInput ç»„ä»¶
**æ–‡ä»¶**: `web/src/components/agents/MessageInput.tsx`

**æ–°å¢åŠŸèƒ½**:
- è¯­éŸ³å½•åˆ¶æŒ‰é’®ï¼ˆé›†æˆ useRecording hookï¼‰
- å›¾ç‰‡ä¸Šä¼ æŒ‰é’®ï¼ˆé›†æˆ useMediaUpload hookï¼‰
- æ–‡ä»¶ä¸Šä¼ æŒ‰é’®
- åª’ä½“é¢„è§ˆåŒºåŸŸï¼ˆå›¾ç‰‡ã€æ–‡ä»¶ã€éŸ³é¢‘ï¼‰
- é¢„è§ˆåˆ é™¤åŠŸèƒ½
- æ ¹æ®åº”ç”¨é…ç½®åŠ¨æ€æ˜¾ç¤ºåŠŸèƒ½

#### å¢å¼ºçš„ AIMessage ç»„ä»¶
**æ–‡ä»¶**: `web/src/components/agents/AIMessage.tsx`

**æ–°å¢åŠŸèƒ½**:
- TTS æŒ‰é’®é›†æˆï¼ˆå³ä¸Šè§’æ“ä½œåŒºï¼‰
- ä¸åé¦ˆæŒ‰é’®å¹¶æ’æ˜¾ç¤º
- æ ¹æ®åº”ç”¨é…ç½®æ§åˆ¶æ˜¾ç¤º

#### å¢å¼ºçš„ EmptyState ç»„ä»¶
**æ–‡ä»¶**: `web/src/components/agents/EmptyState.tsx`

**æ–°å¢åŠŸèƒ½**:
- é›†æˆ UserInputForm ç»„ä»¶
- è¡¨å•æ•°æ®ä¼ é€’åˆ°åç»­æ¶ˆæ¯
- ä¸å¼€åœºç™½å’Œå»ºè®®é—®é¢˜åè°ƒæ˜¾ç¤º

### 3. é…ç½®ä¼ é€’æ¶æ„

**AgentChatPanel** â†’ **MessageList** â†’ **AIMessage**
**AgentChatPanel** â†’ **MessageInput**
**AgentChatPanel** â†’ **EmptyState** â†’ **UserInputForm**

é…ç½®é€šè¿‡ props å±‚å±‚ä¼ é€’ï¼Œç¡®ä¿æ‰€æœ‰ç»„ä»¶éƒ½èƒ½æ ¹æ®åº”ç”¨å‚æ•°åŠ¨æ€è°ƒæ•´åŠŸèƒ½ã€‚

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•é¡µé¢
**URL**: `http://localhost:3000/test-agent-features`

**æµ‹è¯•å†…å®¹**:
1. âœ… ç”¨æˆ·è¾“å…¥è¡¨å• - æ‰€æœ‰å­—æ®µç±»å‹æ­£å¸¸æ¸²æŸ“å’ŒéªŒè¯
2. âœ… æ–‡å­—è½¬è¯­éŸ³ - æŒ‰é’®æ­£å¸¸æ˜¾ç¤ºå’Œäº¤äº’
3. âœ… å¢å¼ºæ¶ˆæ¯è¾“å…¥ - è¯­éŸ³ã€å›¾ç‰‡ã€æ–‡ä»¶ä¸Šä¼ æŒ‰é’®æ­£å¸¸
4. âœ… AIæ¶ˆæ¯ç»„ä»¶ - TTSæŒ‰é’®å’Œæµå¼Markdownæ­£å¸¸
5. âœ… åº”ç”¨é…ç½® - é…ç½®æ•°æ®æ­£ç¡®ä¼ é€’å’Œè§£æ

### åŠŸèƒ½éªŒè¯ç»“æœ

| åŠŸèƒ½ | å‰ç«¯UI | äº¤äº’é€»è¾‘ | é…ç½®æ§åˆ¶ | çŠ¶æ€ |
|------|--------|----------|----------|------|
| ç”¨æˆ·è¾“å…¥è¡¨å• | âœ… | âœ… | âœ… | å®Œæˆ |
| è¯­éŸ³è¾“å…¥ | âœ… | âœ… | âœ… | å®Œæˆ |
| æ–‡ä»¶ä¸Šä¼  | âœ… | âœ… | âœ… | å®Œæˆ |
| æ–‡å­—è½¬è¯­éŸ³ | âœ… | âœ… | âœ… | å®Œæˆ |

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. é…ç½®åº”ç”¨å‚æ•°

åœ¨ Dify æˆ–åç«¯é…ç½®ä¸­è®¾ç½®åº”ç”¨å‚æ•°ï¼š

```json
{
  "user_input_form": [
    {
      "variable": "name",
      "label": "å§“å",
      "type": "text-input",
      "required": true,
      "max_length": 50
    }
  ],
  "speech_to_text": {
    "enabled": true
  },
  "file_upload": {
    "enabled": true,
    "allowed_file_types": ["image", "document"]
  },
  "text_to_speech": {
    "enabled": true,
    "voice": "zh-CN-XiaoxiaoNeural"
  }
}
```

### 2. ç»„ä»¶ä½¿ç”¨

```tsx
// åœ¨ AgentChatPanel ä¸­è‡ªåŠ¨è·å–é…ç½®
<AgentChatPanel
  agents={agents}
  selectedAgent={selectedAgent}
  onSelectAgent={handleSelectAgent}
/>

// é…ç½®ä¼šè‡ªåŠ¨ä¼ é€’ç»™æ‰€æœ‰å­ç»„ä»¶
// - MessageInput æ ¹æ®é…ç½®æ˜¾ç¤ºè¯­éŸ³/æ–‡ä»¶ä¸Šä¼ æŒ‰é’®
// - AIMessage æ ¹æ®é…ç½®æ˜¾ç¤ºTTSæŒ‰é’®
// - EmptyState æ ¹æ®é…ç½®æ˜¾ç¤ºç”¨æˆ·è¾“å…¥è¡¨å•
```

### 3. è‡ªå®šä¹‰è¡¨å•å­—æ®µ

```tsx
const customFields: UserInputFormField[] = [
  {
    variable: 'email',
    label: 'é‚®ç®±',
    type: 'text-input',
    required: true,
    description: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'
  },
  {
    variable: 'category',
    label: 'åˆ†ç±»',
    type: 'select',
    required: true,
    options: ['æŠ€æœ¯å’¨è¯¢', 'äº§å“å’¨è¯¢', 'å…¶ä»–']
  }
];
```

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### 1. çŠ¶æ€ç®¡ç†
- ä½¿ç”¨ React hooks ç®¡ç†ç»„ä»¶çŠ¶æ€
- è¡¨å•éªŒè¯ä½¿ç”¨æœ¬åœ°çŠ¶æ€
- åª’ä½“é¢„è§ˆä½¿ç”¨ URL.createObjectURL
- é…ç½®é€šè¿‡ props ä¼ é€’ï¼Œé¿å…å…¨å±€çŠ¶æ€

### 2. é”™è¯¯å¤„ç†
- è¡¨å•éªŒè¯é”™è¯¯æ˜¾ç¤º
- API è°ƒç”¨é”™è¯¯æç¤º
- éŸ³é¢‘æ’­æ”¾é”™è¯¯å¤„ç†
- æ–‡ä»¶ä¸Šä¼ é”™è¯¯å¤„ç†

### 3. æ€§èƒ½ä¼˜åŒ–
- ç»„ä»¶ä½¿ç”¨ memo ä¼˜åŒ–
- éŸ³é¢‘èµ„æºè‡ªåŠ¨æ¸…ç†
- æ¡ä»¶æ¸²æŸ“å‡å°‘ä¸å¿…è¦çš„ç»„ä»¶
- æ‡’åŠ è½½å’ŒæŒ‰éœ€å¯¼å…¥

### 4. å¯è®¿é—®æ€§
- è¯­ä¹‰åŒ– HTML æ ‡ç­¾
- ARIA å±æ€§æ”¯æŒ
- é”®ç›˜å¯¼èˆªæ”¯æŒ
- å±å¹•é˜…è¯»å™¨å‹å¥½

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

### 1. å‰ç«¯éƒ¨ç½²
```bash
cd web
npm run build
npm start
```

### 2. åç«¯é…ç½®
ç¡®ä¿åç«¯ API æ”¯æŒä»¥ä¸‹ç«¯ç‚¹ï¼š
- `GET /api/v1/agent/{agent_config_id}/parameters` - è·å–åº”ç”¨å‚æ•°
- `POST /api/v1/agent/{agent_config_id}/text-to-audio` - æ–‡å­—è½¬è¯­éŸ³
- `POST /api/v1/agent/{agent_config_id}/audio-to-text` - è¯­éŸ³è½¬æ–‡å­—
- `POST /api/v1/agent/{agent_config_id}/upload` - æ–‡ä»¶ä¸Šä¼ 

### 3. ç¯å¢ƒå˜é‡
```env
# å‰ç«¯
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000/api/v1

# åç«¯
DIFY_API_BASE_URL=your_dify_url
DIFY_API_KEY=your_dify_key
```

---

## ğŸ“ˆ åç»­å»ºè®®

### 1. åŠŸèƒ½å¢å¼º
- [ ] æ–‡ä»¶ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- [ ] è¯­éŸ³å½•åˆ¶æ³¢å½¢æ˜¾ç¤º
- [ ] è¡¨å•å­—æ®µæ¡ä»¶æ˜¾ç¤º
- [ ] å¤šè¯­è¨€æ”¯æŒ

### 2. æ€§èƒ½ä¼˜åŒ–
- [ ] éŸ³é¢‘æµå¼æ’­æ”¾
- [ ] å›¾ç‰‡æ‡’åŠ è½½
- [ ] ç»„ä»¶ä»£ç åˆ†å‰²
- [ ] ç¼“å­˜ç­–ç•¥ä¼˜åŒ–

### 3. ç”¨æˆ·ä½“éªŒ
- [ ] æ‹–æ‹½æ–‡ä»¶ä¸Šä¼ 
- [ ] è¯­éŸ³è¾“å…¥å®æ—¶è½¬æ–‡å­—
- [ ] è¡¨å•è‡ªåŠ¨ä¿å­˜
- [ ] å¿«æ·é”®æ”¯æŒ

### 4. æµ‹è¯•è¦†ç›–
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] E2E æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

---

## ğŸ¯ æ€»ç»“

æœ¬æ¬¡å¼€å‘æˆåŠŸå®ç°äº† Agent Chat ç³»ç»Ÿçš„æ ¸å¿ƒå¢å¼ºåŠŸèƒ½ï¼š

1. **å¯¹è¯å‰è¾“å…¥è¡¨å•** - æä¾›äº†çµæ´»çš„æ•°æ®æ”¶é›†èƒ½åŠ›
2. **è¯­éŸ³äº¤äº’** - æ”¯æŒè¯­éŸ³è¾“å…¥å’Œè¯­éŸ³è¾“å‡º
3. **æ–‡ä»¶å¤„ç†** - æ”¯æŒå¤šç§æ–‡ä»¶ç±»å‹çš„ä¸Šä¼ å’Œé¢„è§ˆ
4. **é…ç½®é©±åŠ¨** - æ‰€æœ‰åŠŸèƒ½éƒ½å¯é€šè¿‡åº”ç”¨å‚æ•°æ§åˆ¶

è¿™äº›åŠŸèƒ½æ˜¾è‘—æå‡äº†ç”¨æˆ·ä½“éªŒï¼Œä½¿ Agent Chat ç³»ç»Ÿæ›´åŠ å®Œæ•´å’Œå®ç”¨ã€‚æ‰€æœ‰ä»£ç éƒ½éµå¾ªäº†é¡¹ç›®çš„å¼€å‘è§„èŒƒï¼Œå…·æœ‰è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚

**æµ‹è¯•é¡µé¢**: http://localhost:3000/test-agent-features
**å®ç°çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆ
**ä»£ç è´¨é‡**: âœ… æ—  lint é”™è¯¯
**åŠŸèƒ½éªŒè¯**: âœ… å…¨éƒ¨é€šè¿‡

---

*å®ç°æ—¶é—´: 2024å¹´12æœˆ*
*å¼€å‘è€…: AI Assistant*
*é¡¹ç›®: AnmeiSmart Agent Chat System*
