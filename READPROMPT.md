# 🤖 与 Claude-4-Sonnet 高效沟通指南

> 本指南帮助开发者在 Cursor 中与 Claude-4-Sonnet 进行高效的AI辅助编程

## 📋 目录
- [核心原则](#核心原则)
- [提示词编写技巧](#提示词编写技巧)
- [利用Cursor特性](#利用cursor特性)
- [场景化模板](#场景化模板)
- [最佳实践](#最佳实践)
- [常见问题](#常见问题)

## 🎯 核心原则

### 1. 明确性原则
- **具体而非抽象**：描述具体的功能需求，而不是模糊的概念
- **完整的上下文**：提供足够的背景信息和技术细节
- **清晰的边界**：明确任务的范围和限制条件

### 2. 渐进式原则
- **分步骤执行**：将复杂任务分解为可管理的小步骤
- **迭代优化**：先实现基本功能，再逐步完善
- **及时反馈**：每个步骤完成后进行确认和调整

### 3. 上下文原则
- **项目结构感知**：充分利用项目的目录结构和代码组织
- **技术栈一致**：确保生成的代码符合项目的技术栈和规范
- **集成考虑**：考虑新代码与现有系统的集成方式

## 💡 提示词编写技巧

### ✅ 好的提示词示例

```markdown
我需要在 FastAPI 后端实现用户认证功能：

**技术要求：**
- 使用 JWT token 进行身份验证
- 密码使用 bcrypt 加密
- 集成现有的 MongoDB 用户模型
- 遵循项目的错误处理模式

**具体需求：**
1. 在 `/api/app/api/v1/endpoints/` 创建 auth.py
2. 实现登录、注册、token刷新接口
3. 添加中间件进行token验证
4. 更新用户模型添加必要字段

**验收标准：**
- 所有接口返回标准的JSON响应
- 包含完整的错误处理
- 提供API文档和测试用例
```

### ❌ 避免的提示词

```markdown
帮我做个登录功能  # 太模糊
写个API          # 缺乏上下文
修复这个bug       # 没有具体信息
```

## 🔧 利用Cursor特性

### 1. 文件上下文管理
```markdown
# 引用特定文件
基于 @api/app/db/models/user.py 中的用户模型，创建相应的CRUD操作

# 选中代码片段
请优化选中的这段代码，提高性能并添加错误处理

# 多文件协作
需要修改以下文件以实现功能：
- @api/app/api/v1/endpoints/users.py
- @web/src/components/UserProfile.tsx
- @api/app/schemas/user.py
```

### 2. 项目结构导航
```markdown
# 明确目录结构
在 `/web/src/components/chat/` 目录下创建聊天组件，
需要与 `/api/app/services/chat/` 中的WebSocket服务对接

# 遵循项目约定
按照项目结构，将新的数据模型放在 `/api/app/db/models/` 目录下
```

### 3. 增量开发
```markdown
# 基于现有代码扩展
基于现有的用户管理功能，添加用户角色权限系统：
1. 扩展User模型添加role字段
2. 创建Role模型和权限检查中间件
3. 更新前端组件显示用户权限
```

## 📝 场景化模板

### 🆕 新功能开发
```markdown
## 功能需求
我需要开发 [功能名称]

**业务描述：**
[详细的业务需求和用户故事]

**技术要求：**
- 后端：FastAPI + SQLAlchemy + MongoDB
- 前端：Next.js + TypeScript + Tailwind CSS
- 认证：JWT token
- 实时通信：WebSocket

**实现范围：**
1. [具体的后端API]
2. [前端组件和页面]
3. [数据库模型变更]
4. [测试用例]

**集成点：**
- 与现有的 [系统/模块] 集成
- 复用 [现有组件/服务]

**验收标准：**
- [功能验收条件]
- [性能要求]
- [安全要求]
```

### 🐛 Bug修复
```markdown
## Bug报告
**问题描述：**
[具体的错误现象]

**错误信息：**
```
[完整的错误日志和堆栈跟踪]
```

**复现步骤：**
1. [详细的操作步骤]
2. [预期结果 vs 实际结果]

**环境信息：**
- 操作系统：[版本]
- Python版本：[版本]
- Node.js版本：[版本]
- 相关依赖版本：[列表]

**影响范围：**
[哪些功能受到影响]

**相关文件：**
- [可能涉及的文件列表]
```

### 🔄 代码重构
```markdown
## 重构需求
**目标文件/模块：**
[具体的文件或模块路径]

**当前问题：**
- [性能问题]
- [可维护性问题]
- [代码重复]
- [架构问题]

**重构目标：**
- [期望达到的效果]
- [性能改进目标]
- [代码质量提升]

**约束条件：**
- 不能破坏现有API接口
- 保持向后兼容性
- 不影响现有测试用例

**重构策略：**
- [具体的重构方法]
- [分步骤执行计划]
```

### ⚡ 性能优化
```markdown
## 性能优化需求
**优化目标：**
[具体的功能或模块]

**当前性能指标：**
- 响应时间：[具体数值]
- 内存使用：[具体数值]
- 并发处理能力：[具体数值]

**性能目标：**
- [期望的改进程度]
- [具体的性能指标]

**已知瓶颈：**
- [数据库查询]
- [算法复杂度]
- [网络请求]
- [内存泄漏]

**优化约束：**
- 不能牺牲功能完整性
- 保持代码可读性
- 考虑维护成本
```

### 🧪 测试编写
```markdown
## 测试需求
**测试类型：**
- [ ] 单元测试
- [ ] 集成测试
- [ ] E2E测试
- [ ] 性能测试

**测试范围：**
[具体的功能模块或API]

**测试场景：**
1. [正常流程测试]
2. [边界条件测试]
3. [异常情况测试]
4. [并发测试]

**测试数据：**
[需要的测试数据和mock对象]

**覆盖率要求：**
- 代码覆盖率：[百分比]
- 分支覆盖率：[百分比]
```

## 🎯 最佳实践

### ✅ 推荐做法

1. **一次一个任务**
   ```markdown
   专注于单一、明确的任务，避免在一个请求中包含多个不相关的需求
   ```

2. **提供完整上下文**
   ```markdown
   包含技术栈、项目结构、现有代码、依赖关系等信息
   ```

3. **明确技术规范**
   ```markdown
   指定代码风格、命名约定、错误处理模式、测试要求等
   ```

4. **描述预期结果**
   ```markdown
   清楚地说明期望的输入、输出、行为和性能要求
   ```

5. **包含验证方法**
   ```markdown
   提供测试方法、验收标准和质量检查点
   ```

### ❌ 避免的做法

1. **模糊的需求描述**
   ```markdown
   ❌ "帮我优化代码"
   ✅ "优化用户查询API的响应时间，目标从500ms降低到100ms以下"
   ```

2. **缺乏技术细节**
   ```markdown
   ❌ "创建一个表单"
   ✅ "使用React Hook Form创建用户注册表单，包含邮箱验证和密码强度检查"
   ```

3. **忽略现有代码**
   ```markdown
   ❌ "写一个新的认证系统"
   ✅ "基于现有的JWT认证系统，添加双因子认证功能"
   ```

4. **没有错误处理考虑**
   ```markdown
   ❌ "实现文件上传功能"
   ✅ "实现文件上传功能，包含文件类型验证、大小限制和上传进度显示"
   ```

## 🔍 常见问题

### Q: 如何处理复杂的多步骤任务？
**A:** 将任务分解为独立的步骤，每步完成后确认再继续：
```markdown
请分步骤实现用户管理系统：
1. 首先创建数据模型和数据库迁移
2. 然后实现CRUD API接口
3. 接着创建前端组件
4. 最后添加测试用例
每步完成后我会确认再进行下一步。
```

### Q: 如何确保生成的代码符合项目规范？
**A:** 在提示词中明确指定项目规范：
```markdown
请遵循项目规范：
- Python: 使用类型注解、遵循PEP8、使用Black格式化
- TypeScript: 严格模式、函数式组件、使用Prettier
- 提交信息: 遵循Conventional Commits规范
- 测试: 每个功能都需要对应的测试用例
```

### Q: 如何处理依赖和环境问题？
**A:** 提供详细的环境信息和依赖列表：
```markdown
环境信息：
- Python 3.11 + FastAPI 0.115.12
- Node.js 18 + Next.js 14
- MongoDB 7.0
- 虚拟环境：venv (已激活)
- 工作目录：/api (后端) 或 /web (前端)

如遇到依赖问题，请检查 requirements.txt 和 package.json
```

### Q: 如何获得更好的代码质量？
**A:** 在请求中明确质量要求：
```markdown
代码质量要求：
- 添加详细的类型注解和文档字符串
- 实现完整的错误处理和日志记录
- 遵循SOLID原则和设计模式
- 包含单元测试和集成测试
- 考虑性能和安全性
```

## 📚 参考资源

- [项目结构说明](./README.md)
- [Python开发规范](./.cursor/rules/languages/python.mdc)
- [TypeScript开发规范](./.cursor/rules/languages/typescript.mdc)
- [Git提交规范](./.cursor/rules/common/git.mdc)

---

**记住：好的提示词 = 明确的需求 + 充分的上下文 + 具体的技术要求 + 清晰的验收标准** 